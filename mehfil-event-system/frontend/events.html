<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Events - Mehfil</title>
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar" id="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <a href="index.html" class="brand-link">
                    <i class="fas fa-masks"></i>
                    <span class="brand-text">Mehfil</span>
                </a>
            </div>
            
            <div class="nav-menu" id="navMenu">
                <a href="index.html" class="nav-link">Home</a>
                <a href="events.html" class="nav-link active">Events</a>
                <a href="about.html" class="nav-link">About</a>
                <a href="contact.html" class="nav-link">Contact</a>
            </div>
            
            <div class="nav-auth" id="navAuth">
                <a href="auth.html" class="btn btn-outline">Login</a>
                <a href="auth.html?register=true" class="btn btn-primary">Sign Up</a>
            </div>
            
            <div class="nav-user hidden" id="navUser">
                <div class="user-dropdown">
                    <button class="user-btn" id="userBtn">
                        <img src="assets/images/default-avatar.png" alt="Profile" class="user-avatar" id="userAvatar">
                        <span class="user-name" id="userName">User</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="dropdown-menu" id="dropdownMenu">
                        <a href="dashboard.html" class="dropdown-item">
                            <i class="fas fa-tachometer-alt"></i> Dashboard
                        </a>
                        <a href="profile.html" class="dropdown-item">
                            <i class="fas fa-user"></i> Profile
                        </a>
                        <div class="dropdown-divider"></div>
                        <button class="dropdown-item logout-btn" id="logoutBtn">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>
            </div>
            
            <button class="nav-toggle" id="navToggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </nav>

    <!-- Page Header -->
    <section class="page-header">
        <div class="container">
            <div class="header-content">
                <h1>Discover Events</h1>
                <p>Find amazing cultural events, performances, and celebrations</p>
            </div>
        </div>
    </section>

    <!-- Events Filter -->
    <section class="events-filter">
        <div class="container">
            <div class="filter-bar">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="Search events...">
                </div>
                
                <div class="filter-group">
                    <select id="categoryFilter" class="filter-select">
                        <option value="">All Categories</option>
                        <option value="music">Music</option>
                        <option value="dance">Dance</option>
                        <option value="theater">Theater</option>
                        <option value="art">Art</option>
                        <option value="literature">Literature</option>
                        <option value="cultural">Cultural</option>
                        <option value="food">Food</option>
                    </select>
                    
                    <select id="locationFilter" class="filter-select">
                        <option value="">All Locations</option>
                        <option value="karachi">Karachi</option>
                        <option value="lahore">Lahore</option>
                        <option value="islamabad">Islamabad</option>
                        <option value="peshawar">Peshawar</option>
                        <option value="quetta">Quetta</option>
                    </select>
                    
                    <select id="dateFilter" class="filter-select">
                        <option value="">All Dates</option>
                        <option value="today">Today</option>
                        <option value="tomorrow">Tomorrow</option>
                        <option value="this-week">This Week</option>
                        <option value="this-month">This Month</option>
                        <option value="next-month">Next Month</option>
                    </select>
                    
                    <select id="priceFilter" class="filter-select">
                        <option value="">All Prices</option>
                        <option value="free">Free</option>
                        <option value="0-1000">Under Rs. 1,000</option>
                        <option value="1000-5000">Rs. 1,000 - 5,000</option>
                        <option value="5000-10000">Rs. 5,000 - 10,000</option>
                        <option value="10000+">Rs. 10,000+</option>
                    </select>
                </div>
                
                <div class="view-toggle">
                    <button class="view-btn active" data-view="grid">
                        <i class="fas fa-th"></i>
                    </button>
                    <button class="view-btn" data-view="list">
                        <i class="fas fa-list"></i>
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Events Grid -->
    <section class="events-section">
        <div class="container">
            <div class="events-loading" id="eventsLoading">
                <div class="loading-spinner"></div>
                <p>Loading events...</p>
            </div>
            
            <div class="events-grid" id="eventsGrid">
                <!-- Events will be populated by JavaScript -->
                <div style="padding: 20px; text-align: center; color: #666;">
                    <p>Loading events...</p>
                </div>
            </div>
            
            <div class="events-empty hidden" id="eventsEmpty">
                <div class="empty-state">
                    <i class="fas fa-calendar-times"></i>
                    <h3>No events found</h3>
                    <p>Try adjusting your search or filter criteria</p>
                    <button class="btn btn-primary" onclick="clearFilters()">Clear Filters</button>
                </div>
            </div>
            
            <div class="pagination hidden" id="pagination">
                <button class="pagination-btn" id="prevBtn" onclick="previousPage()">
                    <i class="fas fa-chevron-left"></i> Previous
                </button>
                <div class="pagination-info" id="pageInfo">
                    Page 1 of 1
                </div>
                <button class="pagination-btn" id="nextBtn" onclick="nextPage()">
                    Next <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="footer-brand">
                        <i class="fas fa-masks"></i>
                        <span>Mehfil</span>
                    </div>
                    <p>Connecting communities through cultural events and celebrations.</p>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
                
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="events.html">Events</a></li>
                        <li><a href="about.html">About</a></li>
                        <li><a href="contact.html">Contact</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Categories</h4>
                    <ul>
                        <li><a href="events.html?category=music">Music</a></li>
                        <li><a href="events.html?category=dance">Dance</a></li>
                        <li><a href="events.html?category=theater">Theater</a></li>
                        <li><a href="events.html?category=art">Art</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Support</h4>
                    <ul>
                        <li><a href="#">Help Center</a></li>
                        <li><a href="#">Terms of Service</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                        <li><a href="#">Refund Policy</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2024 Mehfil. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Loading Overlay -->
    <div class="loading-overlay hidden" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <p>Loading...</p>
    </div>

    <!-- Notification -->
    <div class="notification hidden" id="notification">
        <span class="notification-message" id="notificationMessage"></span>
        <button class="notification-close" id="notificationClose">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <!-- Scripts -->
    <script src="assets/js/config.js"></script>
    <script src="assets/js/utils.js"></script>
    <script src="assets/js/api.js"></script>
    <script src="assets/js/auth.js"></script>
    <script src="assets/js/main-simple.js"></script>
    
    <script>
        // Events page specific JavaScript
        let currentPage = 1;
        let totalPages = 1;
        let currentFilters = {};

        // Main event loading function
        async function loadEventsDirectly() {
            const eventsGrid = document.getElementById('eventsGrid');
            
            try {
                console.log('Loading events...');
                
                // Show loading if available
                if (typeof showLoading === 'function') {
                    showLoading();
                }
                
                const response = await fetch('http://localhost:5000/api/events');
                const events = await response.json();
                
                console.log('Events loaded:', events.length);
                
                // Hide loading if available
                if (typeof hideLoading === 'function') {
                    hideLoading();
                }
                
                if (events && events.length > 0) {
                    eventsGrid.innerHTML = events.map(event => `
                        <div class="event-card" style="border: 1px solid #ddd; border-radius: 8px; padding: 20px; margin: 10px; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <h3 style="margin: 0 0 10px 0; color: #333;">${event.title}</h3>
                            <p style="margin: 5px 0; color: #666;"><strong>Category:</strong> ${event.category}</p>
                            <p style="margin: 5px 0; color: #666;"><strong>Date:</strong> ${new Date(event.dateTime.start).toLocaleDateString()}</p>
                            <p style="margin: 5px 0; color: #666;"><strong>Venue:</strong> ${event.venue.name}</p>
                            <p style="margin: 10px 0; color: #555;">${event.description.substring(0, 150)}...</p>
                            <a href="event-details.html?id=${event._id}" class="btn btn-primary" style="display: inline-block; background: #007bff; color: white; padding: 8px 16px; text-decoration: none; border-radius: 4px; margin-top: 10px;">View Details</a>
                        </div>
                    `).join('');
                } else {
                    eventsGrid.innerHTML = '<div style="text-align: center; padding: 40px; color: #666;"><h3>No events found</h3><p>Check back later for exciting events!</p></div>';
                }
            } catch (error) {
                console.error('Error loading events:', error);
                
                // Hide loading if available
                if (typeof hideLoading === 'function') {
                    hideLoading();
                }
                
                eventsGrid.innerHTML = `<div style="text-align: center; padding: 40px; color: #e74c3c;"><h3>Error loading events</h3><p>Please refresh the page and try again.</p></div>`;
                
                // Show notification if available
                if (typeof showNotification === 'function') {
                    showNotification('Failed to load events. Please try again.', 'error');
                }
            }
        }

        // Load events when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Events page DOM loaded');
            loadEventsDirectly();
        });

        // Utility function for debouncing search input
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
    </script>
</body>
</html>
